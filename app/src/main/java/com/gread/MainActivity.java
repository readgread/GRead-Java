package com.gread;import android.content.Intent;import android.graphics.Typeface;import android.os.Bundle;import android.os.StrictMode;import android.support.annotation.NonNull;import android.support.v4.app.FragmentActivity;import android.view.View;import android.view.Window;import android.view.WindowManager;import android.widget.TextView;import com.facebook.AccessToken;import com.facebook.CallbackManager;import com.facebook.FacebookCallback;import com.facebook.FacebookException;import com.facebook.drawee.backends.pipeline.Fresco;import com.facebook.login.LoginResult;import com.facebook.login.widget.LoginButton;import com.google.android.gms.auth.api.Auth;import com.google.android.gms.auth.api.signin.GoogleSignInAccount;import com.google.android.gms.auth.api.signin.GoogleSignInOptions;import com.google.android.gms.auth.api.signin.GoogleSignInResult;import com.google.android.gms.common.SignInButton;import com.google.android.gms.common.api.GoogleApiClient;import com.google.android.gms.tasks.OnCompleteListener;import com.google.android.gms.tasks.Task;import com.google.firebase.auth.AuthCredential;import com.google.firebase.auth.AuthResult;import com.google.firebase.auth.FacebookAuthProvider;import com.google.firebase.auth.FirebaseAuth;import com.google.firebase.auth.FirebaseUser;import com.google.firebase.auth.GoogleAuthProvider;public class MainActivity extends FragmentActivity{    TextView logo, caption;    private static final int RC_SIGN_IN = 9001;    public static final String USER_PREFS_NAME = "User Information";    private FirebaseAuth mauth;    private FirebaseAuth.AuthStateListener mAuthListener;    private GoogleApiClient googleApiClient;    CallbackManager callbackManager;    protected void onCreate(Bundle savedInstanceState)    {        super.onCreate(savedInstanceState);        Fresco.initialize(this);        requestWindowFeature(Window.FEATURE_NO_TITLE);        StrictMode.ThreadPolicy policy = new StrictMode.ThreadPolicy.Builder().permitAll().build();        StrictMode.setThreadPolicy(policy);        this.getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN,                WindowManager.LayoutParams.FLAG_FULLSCREEN);        setContentView(R.layout.activity_main);        GoogleSignInOptions gso = new GoogleSignInOptions.Builder(GoogleSignInOptions.DEFAULT_SIGN_IN)                .requestIdToken(getString(R.string.server_client_id))                .requestEmail()                .build();        googleApiClient = new GoogleApiClient.Builder(this)                .addApi(Auth.GOOGLE_SIGN_IN_API, gso)                .build();        mauth = FirebaseAuth.getInstance();        mAuthListener = new FirebaseAuth.AuthStateListener() {            @Override            public void onAuthStateChanged(@NonNull FirebaseAuth firebaseAuth) {                FirebaseUser user_google = firebaseAuth.getCurrentUser();                if(user_google != null)                {                    Intent loggedin = new Intent(MainActivity.this, HomeActivity.class);                    loggedin.putExtra("DisplayName", user_google.getDisplayName());                    loggedin.putExtra("Email", user_google.getEmail());                    loggedin.putExtra("PhotoURL", String.valueOf(user_google.getPhotoUrl()));                    startActivity(loggedin);                }            }        };            logo=(TextView)findViewById(R.id.logo_gread);            caption=(TextView)findViewById(R.id.caption_text);            Typeface face= Typeface.createFromAsset(getAssets(), "fonts/Meltix.otf");            logo.setTypeface(face);            Typeface face1= Typeface.createFromAsset(getAssets(), "fonts/Port.ttf");            caption.setTypeface(face1);        SignInButton google_button = (SignInButton) findViewById(R.id.sign_in_button);        google_button.setSize(SignInButton.SIZE_WIDE);        google_button.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                Intent signInIntent = Auth.GoogleSignInApi.getSignInIntent(googleApiClient);                startActivityForResult(signInIntent, RC_SIGN_IN);            }        });        callbackManager = CallbackManager.Factory.create();        final LoginButton loginButtonfb = (LoginButton) findViewById(R.id.sign_in_fb);        loginButtonfb.setReadPermissions("email", "public_profile");        loginButtonfb.registerCallback(callbackManager, new FacebookCallback<LoginResult>() {            @Override            public void onSuccess(LoginResult loginResult) {                handleFacebookAccessToken(loginResult.getAccessToken());            }            @Override            public void onCancel() {            }            @Override            public void onError(FacebookException error) {            }        });        }    @Override    protected void onStart() {        super.onStart();        mauth.addAuthStateListener(mAuthListener);    }    @Override    protected void onStop() {        super.onStop();        if(mAuthListener != null)            mauth.removeAuthStateListener(mAuthListener);    }    @Override    protected void onActivityResult(int requestCode, int resultCode, Intent data) {        super.onActivityResult(requestCode, resultCode, data);        if(requestCode == RC_SIGN_IN){            GoogleSignInResult result = Auth.GoogleSignInApi.getSignInResultFromIntent(data);            if(result.isSuccess()){                GoogleSignInAccount account = result.getSignInAccount();                firebaseAuthWithGoogle(account);            }        }        else            callbackManager.onActivityResult(requestCode, resultCode, data);    }    private void firebaseAuthWithGoogle(GoogleSignInAccount account){        String id = account.getIdToken();        AuthCredential credential = GoogleAuthProvider.getCredential(account.getIdToken(), null);        mauth.signInWithCredential(credential)                .addOnCompleteListener(this, new OnCompleteListener<AuthResult>() {                    @Override                    public void onComplete(@NonNull Task<AuthResult> task) {                    }                });    }    private void handleFacebookAccessToken(AccessToken token){        final AuthCredential credential = FacebookAuthProvider.getCredential(token.getToken());        mauth.signInWithCredential(credential)                .addOnCompleteListener(this, new OnCompleteListener<AuthResult>() {                    @Override                    public void onComplete(@NonNull Task<AuthResult> task) {                    }                });    }}